<div class="provider-services-container">
  <!-- Header -->
  <div class="services-header">
    <div class="header-content">
      <h1>{{ 'provider.services.title' | translate }}</h1>
      <p>{{ 'provider.services.subtitle' | translate }}</p>
    </div>
    <button class="btn btn-primary" (click)="addNewService()">
      {{ 'provider.services.addNew' | translate }}
    </button>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <!-- Search -->
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        [placeholder]="'provider.services.search.placeholder' | translate"
        class="search-input">
    </div>

    <!-- Filters -->
    <div class="filter-bar">
      <div class="filter-group">
        <label>{{ 'provider.services.filters.status' | translate }}</label>
        <select [(ngModel)]="selectedStatus" (ngModelChange)="onStatusChange()" class="filter-select">
          <option value="">{{ 'provider.services.filters.allStatus' | translate }}</option>
          <option value="Active">{{ 'status.active' | translate }}</option>
          <option value="Inactive">{{ 'status.inactive' | translate }}</option>
          <option value="Pending">{{ 'status.pending' | translate }}</option>
          <option value="Rejected">{{ 'status.rejected' | translate }}</option>
          <option value="Suspended">{{ 'status.suspended' | translate }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ 'provider.services.filters.category' | translate }}</label>
        <select [(ngModel)]="selectedCategory" (ngModelChange)="onCategoryChange()" class="filter-select">
          <option value="">{{ 'provider.services.filters.allCategories' | translate }}</option>
          <option *ngFor="let category of categories" [value]="category.categoryId">
            {{ category.nameEn }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ 'provider.services.filters.sortBy' | translate }}</label>
        <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()" class="filter-select">
          <option value="createdAt">{{ 'provider.services.filters.sortDate' | translate }}</option>
          <option value="name">{{ 'provider.services.filters.sortName' | translate }}</option>
          <option value="price">{{ 'provider.services.filters.sortPrice' | translate }}</option>
          <option value="totalBookings">{{ 'provider.services.filters.sortBookings' | translate }}</option>
          <option value="averageRating">{{ 'provider.services.filters.sortRating' | translate }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ 'provider.services.filters.order' | translate }}</label>
        <select [(ngModel)]="sortOrder" (ngModelChange)="onSortChange()" class="filter-select">
          <option value="asc">{{ 'provider.services.filters.ascending' | translate }}</option>
          <option value="desc">{{ 'provider.services.filters.descending' | translate }}</option>
        </select>
      </div>

      <div class="filter-group">
        <button class="clear-btn" (click)="clearFilters()">
          {{ 'provider.services.filters.clear' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="!isLoading">
    <p>{{ 'provider.services.results' | translate:{ count: services.length, total: totalCount } }}</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>{{ 'common.loading' | translate }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && services.length === 0" class="empty-state">
    <div class="empty-icon">üõéÔ∏è</div>
    <h2>{{ 'provider.services.empty.title' | translate }}</h2>
    <p *ngIf="searchTerm || selectedStatus || selectedCategory">
      {{ 'provider.services.empty.filtered' | translate }}
    </p>
    <p *ngIf="!searchTerm && !selectedStatus && !selectedCategory">
      {{ 'provider.services.empty.noServices' | translate }}
    </p>
    <div class="empty-actions">
      <button class="btn btn-primary" (click)="addNewService()">
        {{ 'provider.services.empty.addFirst' | translate }}
      </button>
      <button class="btn btn-secondary" (click)="clearFilters()" *ngIf="searchTerm || selectedStatus || selectedCategory">
        {{ 'provider.services.filters.clear' | translate }}
      </button>
    </div>
  </div>

  <!-- Services Grid -->
  <div *ngIf="!isLoading && services.length > 0" class="services-grid">
    <div *ngFor="let service of services" class="service-card">
      <!-- Service Image -->
      <div class="service-image">
        <img [src]="getServiceImage(service)" [alt]="service.name">
        <span class="status-badge" [class]="getStatusClass(service.status)">
          {{ 'status.' + service.status.toLowerCase() | translate }}
        </span>
      </div>

      <!-- Service Content -->
      <div class="service-content">
        <h3>{{ service.name }}</h3>

        <div class="service-meta">
          <span class="category">{{ getCategoryName(service.categoryId) }}</span>
          <span class="price">{{ formatCurrency(service.price) }}</span>
        </div>

        <p class="service-description">{{ service.description }}</p>

        <div class="service-stats">
          <div class="stat">
            <span class="stat-icon">‚≠ê</span>
            <span class="stat-value">{{ service.averageRating || 0 }}</span>
            <span class="stat-label">({{ service.totalReviews || 0 }})</span>
          </div>
          <div class="stat">
            <span class="stat-icon">üìÖ</span>
            <span class="stat-value">{{ service.totalBookings || 0 }}</span>
            <span class="stat-label">{{ 'provider.services.stats.bookings' | translate }}</span>
          </div>
          <div class="stat">
            <span class="stat-icon">üïê</span>
            <span class="stat-value">{{ service.duration }}</span>
            <span class="stat-label">{{ 'provider.services.stats.minutes' | translate }}</span>
          </div>
        </div>

        <div class="service-dates">
          <p class="created-date">{{ 'provider.services.created' | translate }}: {{ formatDate(service.createdAt) }}</p>
        </div>

        <!-- Actions -->
        <div class="service-actions">
          <button class="btn btn-sm btn-primary" (click)="viewServiceDetail(service.serviceId)">
            {{ 'provider.services.actions.view' | translate }}
          </button>
          <button class="btn btn-sm btn-secondary" (click)="editService(service.serviceId)"
            [disabled]="!canEditService(service)">
            {{ 'provider.services.actions.edit' | translate }}
          </button>
          <button class="btn btn-sm btn-warning" (click)="openStatusModal(service)"
            *ngIf="canChangeStatus(service)">
            {{ service.status === 'Active' ? ('provider.services.actions.deactivate' | translate) : ('provider.services.actions.activate' | translate) }}
          </button>
          <button class="btn btn-sm btn-secondary" (click)="duplicateService(service)">
            {{ 'provider.services.actions.duplicate' | translate }}
          </button>
          <button class="btn btn-sm btn-danger" (click)="openDeleteModal(service)">
            {{ 'provider.services.actions.delete' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && totalPages > 1" class="pagination">
    <button class="page-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
      {{ 'pagination.previous' | translate }}
    </button>

    <button *ngIf="paginationPages[0] > 1" class="page-btn" (click)="goToPage(1)">1</button>
    <span *ngIf="paginationPages[0] > 2" class="page-dots">...</span>

    <button
      *ngFor="let page of paginationPages"
      class="page-btn"
      [class.active]="page === currentPage"
      (click)="goToPage(page)">
      {{ page }}
    </button>

    <span *ngIf="paginationPages[paginationPages.length - 1] < totalPages - 1" class="page-dots">...</span>
    <button *ngIf="paginationPages[paginationPages.length - 1] < totalPages" class="page-btn" (click)="goToPage(totalPages)">
      {{ totalPages }}
    </button>

    <button class="page-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
      {{ 'pagination.next' | translate }}
    </button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ 'provider.services.modals.delete.title' | translate }}</h2>
      <button class="close-btn" (click)="closeDeleteModal()">√ó</button>
    </div>

    <div class="modal-body">
      <p>{{ 'provider.services.modals.delete.message' | translate:{ name: selectedService?.name } }}</p>
      <p class="warning-text">{{ 'provider.services.modals.delete.warning' | translate }}</p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()" [disabled]="isDeleting">
        {{ 'common.cancel' | translate }}
      </button>
      <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
        {{ isDeleting ? ('common.processing' | translate) : ('common.delete' | translate) }}
      </button>
    </div>
  </div>
</div>

<!-- Status Change Modal -->
<div *ngIf="showStatusModal" class="modal-overlay" (click)="closeStatusModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ 'provider.services.modals.status.title' | translate }}</h2>
      <button class="close-btn" (click)="closeStatusModal()">√ó</button>
    </div>

    <div class="modal-body">
      <p>{{ 'provider.services.modals.status.message' | translate:{ name: selectedService?.name } }}</p>

      <div class="form-group">
        <label>{{ 'provider.services.modals.status.newStatus' | translate }}</label>
        <select [(ngModel)]="newStatus" class="form-control">
          <option value="Active">{{ 'status.active' | translate }}</option>
          <option value="Inactive">{{ 'status.inactive' | translate }}</option>
        </select>
      </div>

      <div class="status-info">
        <p *ngIf="newStatus === 'Active'" class="info-text success">
          {{ 'provider.services.modals.status.activeInfo' | translate }}
        </p>
        <p *ngIf="newStatus === 'Inactive'" class="info-text warning">
          {{ 'provider.services.modals.status.inactiveInfo' | translate }}
        </p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeStatusModal()">
        {{ 'common.cancel' | translate }}
      </button>
      <button class="btn btn-primary" (click)="confirmStatusChange()">
        {{ 'common.update' | translate }}
      </button>
    </div>
  </div>
</div>
