<div class="bookings-container">
  <!-- Header with Statistics -->
  <div class="bookings-header">
    <h1>My Bookings</h1>
    <div class="statistics" *ngIf="!loading">
      <div class="stat-card">
        <span class="stat-value">{{ totalBookings }}</span>
        <span class="stat-label">Total Bookings</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ activeBookings }}</span>
        <span class="stat-label">Active</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ completedBookings }}</span>
        <span class="stat-label">Completed</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ formatPrice(totalSpent) }}</span>
        <span class="stat-label">Total Spent</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <!-- Status Filters -->
    <div class="status-filters">
      <button
        class="filter-btn"
        [class.active]="selectedStatus === null"
        (click)="filterByStatus(null)"
      >
        All <span class="count">{{ totalCount }}</span>
      </button>
      <button
        *ngFor="let status of statuses"
        class="filter-btn"
        [class.active]="selectedStatus === status.value"
        (click)="filterByStatus(status.value)"
      >
        {{ status.label }} <span class="count" *ngIf="status.count > 0">{{ status.count }}</span>
      </button>
    </div>

    <!-- Search and Date Filters -->
    <div class="advanced-filters">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Search bookings..."
          class="search-input"
        />
      </div>

      <div class="date-filters">
        <input
          type="date"
          [(ngModel)]="startDate"
          (ngModelChange)="onDateFilterChange()"
          placeholder="Start Date"
          class="date-input"
        />
        <span>to</span>
        <input
          type="date"
          [(ngModel)]="endDate"
          (ngModelChange)="onDateFilterChange()"
          placeholder="End Date"
          class="date-input"
        />
      </div>

      <button
        class="clear-filters-btn"
        (click)="clearFilters()"
        *ngIf="hasActiveFilters()"
      >
        Clear Filters ({{ getActiveFilterCount() }})
      </button>
    </div>
  </div>

  <!-- Bookings List -->
  <div class="bookings-list" *ngIf="!loading && bookings.length > 0">
    <div
      *ngFor="let booking of bookings; trackBy: trackByBookingId"
      class="booking-card"
      (click)="viewBookingDetails(booking.bookingId)"
    >
      <!-- Header -->
      <div class="booking-header">
        <div class="booking-info">
          <h3>{{ booking.serviceName }}</h3>
          <span class="booking-number">{{ booking.bookingNumber }}</span>
        </div>
        <span class="status-badge" [ngClass]="getBookingStatusClass(booking.status)">
          {{ getBookingStatusLabel(booking.status) }}
        </span>
      </div>

      <!-- Details -->
      <div class="booking-details">
        <div class="detail-row">
          <span class="icon">üìÖ</span>
          <div class="detail-content">
            <span class="label">Scheduled for</span>
            <span class="value">{{ formatDate(booking.scheduledDateTime) }}</span>
          </div>
        </div>

        <div class="detail-row">
          <span class="icon">üí∞</span>
          <div class="detail-content">
            <span class="label">Total Amount</span>
            <span class="value price">{{ formatPrice(booking.totalAmount) }}</span>
          </div>
        </div>

        <div class="detail-row">
          <span class="icon">üìç</span>
          <div class="detail-content">
            <span class="label">Location</span>
            <span class="value">{{ booking.address.city }}, {{ booking.address.region }}</span>
          </div>
        </div>

        <div class="detail-row">
          <span class="icon">üí≥</span>
          <div class="detail-content">
            <span class="label">Payment</span>
            <span class="value">{{ booking.paymentMethod }}</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="booking-actions" (click)="$event.stopPropagation()">
        <button
          class="btn btn-primary"
          (click)="viewBookingDetails(booking.bookingId)"
        >
          View Details
        </button>

        <button
          *ngIf="canCancelBooking(booking)"
          class="btn btn-danger"
          (click)="cancelBooking(booking)"
        >
          Cancel Booking
        </button>

        <button
          *ngIf="canReviewBooking(booking)"
          class="btn btn-success"
          (click)="viewBookingDetails(booking.bookingId)"
        >
          Write Review
        </button>

        <button
          class="btn btn-secondary"
          (click)="bookAgain(booking)"
        >
          Book Again
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading bookings...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && bookings.length === 0">
    <div class="empty-icon">üìã</div>
    <h2>No Bookings Found</h2>
    <p *ngIf="hasActiveFilters()">
      Try adjusting your filters to see more results.
    </p>
    <p *ngIf="!hasActiveFilters()">
      You haven't made any bookings yet.
    </p>
    <button class="btn btn-primary" routerLink="/services" *ngIf="!hasActiveFilters()">
      Browse Services
    </button>
    <button class="btn btn-secondary" (click)="clearFilters()" *ngIf="hasActiveFilters()">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!loading && totalPages > 1">
    <button
      class="page-btn"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      ‚Üê Previous
    </button>

    <button
      *ngFor="let page of paginationPages"
      class="page-btn"
      [class.active]="page === currentPage"
      (click)="goToPage(page)"
    >
      {{ page }}
    </button>

    <button
      class="page-btn"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next ‚Üí
    </button>
  </div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="!loading && bookings.length > 0">
    <p>
      Showing {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalCount) }}
      of {{ totalCount }} bookings
    </p>
  </div>
</div>
