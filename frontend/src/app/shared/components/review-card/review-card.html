<mat-card class="review-card">
  <mat-card-header>
    <div class="review-header">
      <div class="user-info">
        <div class="avatar">
          @if (review.userAvatar) {
            <img [src]="review.userAvatar" [alt]="review.userName">
          } @else {
            <mat-icon>person</mat-icon>
          }
        </div>
        <div class="user-details">
          <h3 class="user-name">
            {{ review.userName }}
            @if (review.isVerified) {
              <mat-icon class="verified-icon" [matTooltip]="'reviews.verified_purchase' | translate">verified</mat-icon>
            }
          </h3>
          <div class="rating-date">
            <div class="rating">
              @for (star of ratingArray; track star) {
                <mat-icon [class.filled]="star <= review.rating">
                  {{ star <= review.rating ? 'star' : 'star_border' }}
                </mat-icon>
              }
              <span class="rating-value">{{ review.rating }}.0</span>
            </div>
            <span class="date">{{ review.createdAt | date: 'medium' }}</span>
          </div>
        </div>
      </div>
      @if (canEdit || canDelete) {
        <div class="action-buttons">
          @if (canEdit) {
            <button mat-icon-button (click)="onEdit()" [matTooltip]="'common.edit' | translate">
              <mat-icon>edit</mat-icon>
            </button>
          }
          @if (canDelete) {
            <button mat-icon-button color="warn" (click)="onDelete()" [matTooltip]="'common.delete' | translate">
              <mat-icon>delete</mat-icon>
            </button>
          }
        </div>
      }
    </div>
  </mat-card-header>

  <mat-card-content>
    @if (showServiceInfo) {
      <div class="service-info">
        <mat-icon>business</mat-icon>
        <span>{{ review.serviceName }} - {{ review.providerName }}</span>
      </div>
    }

    @if (review.comment) {
      <p class="comment">{{ review.comment }}</p>
    }

    @if (review.imageUrls && review.imageUrls.length > 0) {
      <div class="review-images">
        @for (imageUrl of review.imageUrls; track imageUrl; let i = $index) {
          @if (i < 4) {
            <div class="image-thumb" (click)="onViewImages()">
              <img [src]="imageUrl" [alt]="'Review image ' + (i + 1)">
              @if (i === 3 && review.imageUrls!.length > 4) {
                <div class="more-overlay">
                  +{{ review.imageUrls!.length - 4 }}
                </div>
              }
            </div>
          }
        }
      </div>
    }

    @if (review.providerResponse) {
      <div class="provider-response">
        <div class="response-header">
          <mat-icon>store</mat-icon>
          <span class="response-label">{{ 'reviews.provider_response' | translate }}</span>
          @if (review.providerResponseDate) {
            <span class="response-date">{{ review.providerResponseDate | date: 'short' }}</span>
          }
        </div>
        <p class="response-text">{{ review.providerResponse }}</p>
      </div>
    }
  </mat-card-content>

  @if (showActions) {
    <mat-card-actions>
      <button mat-button (click)="onHelpful()" [disabled]="review.isHelpful">
        <mat-icon>thumb_up</mat-icon>
        {{ 'reviews.helpful' | translate }} ({{ review.helpfulCount }})
      </button>
      @if (canRespond && !review.providerResponse) {
        <button mat-button color="primary" (click)="onRespond()">
          <mat-icon>reply</mat-icon>
          {{ 'reviews.respond' | translate }}
        </button>
      }
    </mat-card-actions>
  }
</mat-card>
