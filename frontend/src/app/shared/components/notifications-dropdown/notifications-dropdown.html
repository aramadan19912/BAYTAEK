<button
  mat-icon-button
  [matMenuTriggerFor]="notificationsMenu"
  [matTooltip]="'notifications.title' | translate">
  <mat-icon [matBadge]="unreadCount" [matBadgeHidden]="unreadCount === 0" matBadgeColor="warn">
    notifications
  </mat-icon>
</button>

<mat-menu #notificationsMenu="matMenu" class="notifications-menu">
  <!-- Header -->
  <div class="notifications-header" (click)="$event.stopPropagation()">
    <h3>{{ 'notifications.title' | translate }}</h3>
    @if (unreadCount > 0) {
      <button mat-button (click)="markAllAsRead()" [disabled]="loading">
        <mat-icon>done_all</mat-icon>
        {{ 'notifications.markAllRead' | translate }}
      </button>
    }
  </div>

  <mat-divider></mat-divider>

  <!-- Notifications List -->
  @if (notifications.length === 0) {
    <div class="no-notifications" (click)="$event.stopPropagation()">
      <mat-icon>notifications_none</mat-icon>
      <p>{{ 'notifications.noNotifications' | translate }}</p>
    </div>
  } @else {
    @for (notification of notifications; track notification.notificationId) {
      <button
        mat-menu-item
        class="notification-item"
        [class.unread]="!notification.isRead"
        (click)="onNotificationClick(notification)">
        <div class="notification-content">
          <div class="notification-icon" [ngClass]="'color-' + getNotificationColor(notification.type)">
            <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
          </div>

          <div class="notification-details">
            <div class="notification-title">{{ getNotificationTitle(notification) }}</div>
            <div class="notification-message">{{ getNotificationMessage(notification) }}</div>
            <div class="notification-time">{{ getNotificationTime(notification.createdAt) }}</div>
          </div>

          @if (!notification.isRead) {
            <div class="unread-indicator"></div>
          }
        </div>
      </button>
    }
  }

  <!-- Footer -->
  @if (notifications.length > 0) {
    <mat-divider></mat-divider>
    <button mat-menu-item class="view-all-button" (click)="viewAllNotifications()">
      <mat-icon>visibility</mat-icon>
      {{ 'notifications.viewAll' | translate }}
    </button>
  }
</mat-menu>
